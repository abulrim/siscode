




(function(a){a.registerHelper("equal",function(b,d,c){if(arguments.length<3){throw new Error("Handlebars Helper equal needs 2 parameters")}if(+b!==+d){return c.inverse(this)}else{return c.fn(this)}})}(Handlebars));
(function(c,d,b){var a=window.App||(window.App={});a.AppView=d.View.extend({el:"body",events:{keyup:"keyup"},initialize:function(e){this.router=e.router},keyup:function(f){if(c(f.target).is("input")){return}if(f.keyCode===37){this.router.previousPage()}else{if(f.keyCode===39){this.router.nextPage()}}}})}(jQuery,Backbone,amplify));
(function(e,g,i,h,b,c){var d=window.App||(window.App={}),f="click",a=navigator.userAgent.match(/mobile/i);if(a&&"ontouchstart" in document.documentElement){f="touchstart"}d.InstitutionModel=g.Model.extend();d.InstitutionCollection=g.Collection.extend({model:d.InstitutionModel});d.InstitutionListView=g.View.extend({template:h.compile(e("#institutions-select").html()),events:{"change select[name=institution_id]":"institutionChanged"},institutionChanged:function(){var k,j;k=this.$("select[name=institution_id]").val();if(k){j=this.collection.get(k).toJSON()}else{j={subjects:[]}}this.trigger("institutionChanged",j)},initialize:function(j){this.collection=new d.InstitutionCollection(j.institutions);this.collection.on("reset",this.render,this)},selectInstitution:function(j){this.$("select[name=institution_id]").val(j).trigger("change").trigger("chosen:updated")},render:function(){this.$el.html(this.template({institutions:this.collection.toJSON()}));return this},afterRender:function(){this.$("select").chosen()}});d.SubjectModel=g.Model.extend();d.SubjectCollection=g.Collection.extend({model:d.SubjectModel});d.CourseInputModel=g.Model.extend();d.CourseInputView=g.View.extend({tagName:"div",className:"cil-course-input",template:h.compile(e("#course-input-tmpl").html()),numberTemplate:h.compile(e("#course-input-numbers").html()),subjectCollection:null,events:{"change select[name=subject_id]":"fillNumber","click .cil-remove-course":"removeCourse","keyup .cil-course-crn":"crnKeyUp"},initialize:function(j){this.subjectCollection=new d.SubjectCollection(j.subjects);this.model.on("remove",this.remove,this)},crnKeyUp:function(j){if(this.$(j.target).val().length>0){this.$("select").prop("disabled",true).trigger("chosen:updated")}else{this.$("select").prop("disabled",false).trigger("chosen:updated")}},fillNumber:function(){var l,k,j;l=this.$("select[name=subject_id]").val();if(l){j=this.subjectCollection.get(l).toJSON()}else{j={numbers:[]}}this.$("select[name=number]").html(this.numberTemplate(j)).trigger("chosen:updated")},render:function(){var j,k=this.model.toJSON();k.subjects=this.subjectCollection.toJSON();this.$el.html(this.template(k)).find("select[name=subject_id]").val(this.model.get("subject_id")).trigger("change").end().find("select[name=number]").val(this.model.get("number"));return this},afterRender:function(){this.$("select").chosen()},removeCourse:function(){this.model.destroy()}});d.CourseInputCollection=g.Collection.extend({model:d.CourseInputModel});d.CourseInputListView=g.View.extend({el:".cil",institutionListView:null,collection:new d.CourseInputCollection(),institution:null,closed:false,events:{"keypress .course-input":"keyLog"},keyLog:function(j){if(j.keyCode===13){this.updateUrlEvent()}},initialize:function(j){this.router=j.router;this.initInstitutionListView(j);this.afterRender();this.collection.on("add",this.addInput,this);this.collection.on("reset",this.collectionReset,this);this.router.on("urlChanged",this.dehasherize,this)},initInstitutionListView:function(k){var j=new d.InstitutionListView({institutions:k.institutions});this.$(".cil-institutions").html(j.render().$el);j.afterRender();j.on("institutionChanged",this.institutionChanged,this);this.institutionListView=j;this.institutionChanged()},institutionChanged:function(j){this.institution=j;this.collection.reset();if(this.institution!==null){this.$(".cil-add-course").show()}else{this.$(".cil-add-course").hide()}},collectionReset:function(k,j){i.each(j.previousModels,function(l){l.trigger("remove")});this.closeInputs()},closeInputs:function(){this.$el.addClass("cil-hidden");e("body").addClass("cil-hidden")},openInputs:function(){this.$el.removeClass("cil-hidden");e("body").removeClass("cil-hidden")},addInput:function(k){var j;j=new d.CourseInputView({model:k,subjects:this.institution.subjects});j.render();this.$(".cil-courses").append(j.$el);j.afterRender()},afterRender:function(){var j=this;this.$(".cil-add-course").on("click",function(){j.addInputModel()});this.$(".cil-submit").on("click",function(){j.updateUrlEvent()});this.$(".cil-expand-arrow").on(f,function(){j.openInputs();return false});return this},addInputModel:function(){this.collection.add(new d.CourseInputModel())},updateUrlEvent:function(){this.updateUrl();this.closeInputs()},updateUrl:function(k){var j=this.getProps();this.router.handleUrl({page:1,institution:this.institution,days:j.days,courses:j.courses})},getProps:function(){var j=[],k=[];this.$(".cil-course-input").each(function(){j.push({subject:e(this).find("select[name=subject_id]").val(),number:e(this).find("select[name=number]").val(),crn:e(this).find("input[name=crn]").val()})});e('input[name^="filter"]').each(function(){if(e(this).prop("checked")){k.push(e(this).val())}});return{courses:j,days:k}},dehasherize:function(o){var n=[],q,p,m,l,j=this,k;n=o.split("_");l=n.splice(0,1)[0];m=n.splice(0,1)[0];p=n.splice(0,1)[0].split("-");this.institutionListView.selectInstitution(l);this.updateFilters(p);this.collection.reset();i.each(n,function(r,s){q=r.split("-");j.collection.add(new d.CourseInputModel({subject_id:q[0],number:q[1],crn:q[2]}))});k=this.getProps();this.router.updateProps({page:m,institution:this.institution,days:k.days,courses:k.courses})},updateFilters:function(l){var j=this.$('input[name^="filter"]'),k=this;j.prop("checked",false);i.each(l,function(m){k.$('input[name="filter['+m+']"]').prop("checked",true)})}})}(jQuery,Backbone,_,Handlebars,amplify));
(function(f,g,b,c,a,e){var d=window.App||(window.App={});d.CourseSlotModel=g.Model.extend();d.CourseSlotView=g.View.extend({tagName:"div",className:"schedule-course-slot",render:function(){var h=c.compile(f("#course-slot-view-tmpl").html()),i;i=this.model.toJSON();i.Course=this.model.courseModel.toJSON();i.start_time=i.start_time.substr(0,5);i.end_time=i.end_time.substr(0,5);this.$el.html(h(i));this.$(".schedule-course-slot-wrapper").css({backgroundColor:this.model.courseModel.get("color").background,borderColor:this.model.courseModel.get("color").border});return this},afterInsert:function(){this.$el.tooltip({tooltip:".tooltip-content"})}});d.CourseSlotCollection=g.Collection.extend({model:d.CourseSlotModel});d.CourseModel=g.Model.extend();d.CourseCollection=g.Collection.extend({model:d.CourseModel,maxPage:0,page:0,webroot:null,router:null,cacheKey:0,colors:[{background:"#73A5F7",border:"#03F"},{background:"#FF828E",border:"#D80505"},{background:"#FF71FF",border:"#B300B3"},{background:"#FFFF80",border:"#FF0"},{background:"#AFA",border:"#80FF00"},{background:"#FFA980",border:"#FF8000"}],initialize:function(h){this.webroot=h.webroot;this.router=h.router;this.cacheKey=h.cacheKey;this.on("reset",this.fixSlots,this);this.router.on("urlChanged",this.fetchUrl,this)},fetchUrl:function(i){var h=this;this.url=this.webroot+"courses/fetch/"+i+".json?_="+this.cacheKey;this.trigger("isLoading",true);this.reset();this.fetch({reset:true,complete:function(){h.trigger("isLoading",false)}})},fixSlots:function(k){var j,i=this,h;b.each(k.models,function(l,m){if(i.colors[m]!==e){h=i.colors[m]}else{h=i.colors[m%i.colors.length]}l.set("color",h);j=l.get("CourseSlot");b.each(j.models,function(n){n.courseModel=l})})},parse:function(h){var i=[];this.maxPage=this.router.maxPage=h.pagination.total;this.page=this.router.page=h.pagination.page;b.each(h.content,function(l){var j=[],k;b.each(l.CourseSlot,function(m){j.push(new d.CourseSlotModel(m))});l.Course.subject_code=l.Subject.code;k=l.Course;k.CourseSlot=new d.CourseSlotCollection(j);i.push(k)});return i}});d.CourseScheduleView=g.View.extend({el:".schedule",errorMessages:["No results! Take a break this semester, work at McDonalds instead","No results! Seriously, flipping burgers is fun","No results! I like fries with my burger","No results! One tawouk, toum extra please","Hooray! No need to come to uni this semester. Just kidding, No results","No results! Have you considered dropping out?","No results! Try LUCK 101","No results! Never give up, Bill Gates was a dropout and look where he is today"],initialize:function(i){var h=this;this.collection=new d.CourseCollection({webroot:i.webroot,router:i.router,cacheKey:i.cacheKey});this.collection.on("reset",this.addAll,this);this.collection.on("isLoading",this.loading,this);this.$(".paginator").each(function(){f(this).html((new d.PaginationView({router:i.router,collection:h.collection})).render().$el)})},loading:function(h){if(h){this.$(".schedule-loader").show()}else{this.$(".schedule-loader").hide()}},addAll:function(k,j){var h=this.$(".schedule-empty-error"),i=this;this.$(".schedule-day").html("");if(j.success&&k.models.length===0){h.html(this.errorMessages[Math.floor(Math.random()*this.errorMessages.length)]);h.show()}else{h.hide()}b.each(k.models,function(l){i.addOne(l)})},addOne:function(n){var i,m,l=this,k,o,j,h;b.each(n.get("CourseSlot").models,function(p){i=new d.CourseSlotView({model:p});i.render();m=l.$(".day-"+p.get("day"));m.append(i.$el);i.afterInsert();o=l.fixTime(p.get("start_time"));j=l.fixTime(p.get("end_time"));k=40+(o*40);h=40+(j*40)-k;i.$el.css({position:"absolute",top:k+"px",height:h+"px"})})},fixTime:function(h){h=h.split(":");h[0]=+h[0];h[1]=+h[1];h=(h[0]-7)+h[1]/60;return h}});d.PaginationView=g.View.extend({tagName:"div",template:c.compile(f("#pagination-view-tmpl").html()),router:null,events:{"click .paginator-next":"updateUrlNext","click .paginator-previous":"updateUrlPrevious"},updateUrlNext:function(){this.router.nextPage()},updateUrlPrevious:function(){this.router.previousPage()},initialize:function(h){this.router=h.router;this.collection.on("reset",this.render,this)},render:function(){var h={page:this.collection.page,maxPage:this.collection.maxPage};this.$el.html(this.template(h));if(+this.collection.page>=+this.collection.maxPage){this.$(".paginator-next").addClass("paginator-disabled")}if(+this.collection.page===1){this.$(".paginator-previous").addClass("paginator-disabled")}if(this.collection.maxPage===0){this.$el.hide()}else{this.$el.show()}return this}})}(jQuery,Backbone,_,Handlebars,amplify));
(function(e,g,i,h,b,c){var d=window.App||(window.App={}),f="click",a=navigator.userAgent.match(/mobile/i);if(a&&"ontouchstart" in document.documentElement){f="touchstart"}d.SavedModel=g.Model.extend({defaults:{url:null,name:null},sync:function(p,l,k){var m,n,o,j;if(p==="create"){m=b.store("savedCombinations");if(!m){m=[]}n=this.toJSON();n.id=i.uniqueId();m.push(n);b.store("savedCombinations",m);k.success(n)}else{if(p==="delete"){o=l.get("id");m=b.store("savedCombinations",m);j=null;i.each(m,function(r,q){if(r.id===o){j=q;return false}});if(j!==null){m.splice(j,1)}b.store("savedCombinations",m)}else{if(p==="update"){o=l.get("id");m=b.store("savedCombinations",m);j=null;i.each(m,function(r,q){if(r.id===o){m[q]=l.toJSON();return false}});b.store("savedCombinations",m)}}}},clear:function(){this.destroy()}});d.SavedView=g.View.extend({tagName:"li",router:null,editMode:false,template:h.compile(e("#foot-bar-combination-tmpl").html()),initialize:function(j){this.router=j.router;this.webroot=j.webroot;this.model.on("destroy",this.remove,this);this.model.on("change:name",this.render,this)},events:function(){var j={};j[f+" a"]="goToSavedUrl";j[f+" .foot-bar-remove"]="removeCombination";j[f+" .foot-bar-edit"]="editCombination";j["keypress input"]="updateCombination";return j},editCombination:function(){if(this.editMode){this.update()}else{this.editMode=true;this.$(".foot-bar-combination-name").hide();this.$("input").show().focus().select()}return false},updateCombination:function(j){if(j.keyCode===13){this.update()}},update:function(){var j;this.$(".foot-bar-combination-name").show();j=this.$("input").hide().val();this.model.save({name:j});this.editMode=false;window.woopraTracker.pushEvent({name:"edit",url:window.location.origin+this.webroot+"c/"+this.model.get("url"),title:j})},removeCombination:function(){window.woopraTracker.pushEvent({name:"delete",url:window.location.origin+this.webroot+"c/"+this.model.get("url"),title:this.model.get("name")});this.model.clear();return false},goToSavedUrl:function(){this.router.navigate("c/"+this.model.get("url"),{trigger:true});return false},render:function(){this.$el.html(this.template(this.model.toJSON()));return this}});d.SavedCollection=g.Collection.extend({model:d.SavedModel,sync:function(m,l,j){if(m==="read"){var k=b.store("savedCombinations");j.success(k)}}});d.SavedCollectionView=g.View.extend({el:".foot-bar",toggled:false,router:null,webroot:null,courseCollection:null,collection:new d.SavedCollection(),events:function(){var j=a?{"touchstart .foot-bar-toggle":"toggleFoot","touchstart .foot-bar-add":"save"}:{"click .foot-bar-toggle":"toggleFoot","click .foot-bar-add":"save"};return j},initialize:function(j){this.router=j.router;this.webroot=j.webroot;this.courseCollection=j.courseCollection;this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this);this.collection.fetch({reset:true})},addAll:function(k){var j=this;i.each(k.models,function(l){j.addSaved(l,true)})},addOne:function(j){this.addSaved(j)},addSaved:function(k,m){var j,l;j=new d.SavedView({router:this.router,webroot:this.webroot,model:k});j.render();l=j.$el;this.$(".foot-bar-combination").prepend(l);if(!m){j.editCombination();if(!this.toggled){this.toggleFoot()}}},toggleFoot:function(){var j;j=this.$(".foot-bar-arrow");if(this.toggled===false){this.$el.addClass("toggled");j.addClass("down");this.toggled=true}else{this.$el.removeClass("toggled");j.removeClass("down");this.toggled=false}return false},crnHash:function(){var k,j=[];i.each(this.courseCollection.models,function(l){j.push("--"+l.get("crn"))});k=[this.router.institution.id,1,this.router.days.join("-"),j.join("_")].join("_");return k},save:function(){if(this.collection.where({url:this.router.url}).length===0&&this.router.url.length!==0){var j="";i.each(this.courseCollection.models,function(k,l){if(l!==0){j+=" - "}j+=k.get("crn")+" ("+k.get("subject_code")+" "+k.get("number")+")"});window.woopraTracker.pushEvent({name:"save",url:window.location.href,title:j});this.collection.create({url:this.crnHash(),name:j})}}})}(jQuery,Backbone,_,Handlebars,amplify));
(function(d,a,c){var b=window.App||(window.App={});b.Router=d.Router.extend({page:1,maxPage:1,institution:null,days:null,courses:null,url:"",routes:{"c/:hash":"urlChanged"},nextPage:function(){if(+this.page!==+this.maxPage){this.page++;this.handleUrl()}},previousPage:function(){if(+this.page!==1){this.page--;this.handleUrl()}},updateProps:function(e){if(typeof e!=="undefined"){this.page=e.page;this.institution=e.institution;this.days=e.days;this.courses=e.courses}},handleUrl:function(e){var g,f=[];this.updateProps(e);a.each(this.courses,function(h){f.push(h.subject+"-"+h.number+"-"+h.crn)});g=[this.institution.id,this.page,this.days.join("-"),f.join("_")].join("_");this.navigate("c/"+g,{trigger:true})},urlChanged:function(e){this.trigger("urlChanged",e);this.url=e;window.woopraTracker.trackPageview({url:"/c/"+e,title:document.title});window._gaq.push(["_trackPageview","/c/"+e])}})}(Backbone,_));
(function(g,l,n,m,b,d){var e=window.App,j=g("body").data("webroot"),k=g("#institutions-data").data("institutions"),h=g("body").data("cache_key");var o=new e.Router();var c=new e.AppView({router:o});var a=new e.CourseInputListView({router:o,institutions:k});var i=new e.CourseScheduleView({webroot:j,cacheKey:h,router:o});var f=new e.SavedCollectionView({courseCollection:i.collection,webroot:j,router:o});l.history.start({pushState:true,root:j})}(jQuery,Backbone,_,Handlebars,amplify));
